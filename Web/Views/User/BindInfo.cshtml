<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>手机验证</title>
    <link rel="stylesheet" type="text/css" href="/Task/css/common.css" />
    <link rel="stylesheet" type="text/css" href="/Task/css/main.css" />
    <link rel="stylesheet" href="/Task/css/style.css">
</head>
<body>
    <div id="app" class="top">
        <div class="code_content">
            <!--账号-->
            <div class="code_phone">
                <div class="code_text">手机号：</div>
                <input class="code_content_input" placeholder="手机号码" v-model="mobile">
            </div>
            <!--输入微信号-->
            <div class="code_wx">
                <div class="code_text">微信号：</div>
                <input class="code_content_input" placeholder="输入微信号" v-model="wechat">
            </div>
            <!--输入支付宝-->
            <div class="code_zhipay">
                <div class="code_text">支付宝：</div>
                <input class="code_content_input" placeholder="输入支付宝" v-model="alipay">
            </div>
            <!--验证码-->
            <div class="code_phonecode">
                <div class="code_text">验证码：</div>
                <input id="code_phonecode_input" placeholder="短信验证码" v-model="code">
                <a v-on:click="send" class="code_phonecode_num">发送短信验证码</a>
            </div>
            <!--按钮-->
            <a v-on:click="btnValid" class="code_button">
                提交验证
            </a>
        </div>
    </div>
    <script type="text/javascript" charset="utf-8" src="/Task/js/flexible.js"></script>
    <script src="~/Task/js/jquery.min.js"></script>
    <script src="~/js/vue.min2.5.16.js"></script>
    <script src="~/js/vue-resource.min1.5.0.js"></script>
    <script src="~/assets/layer/layer.js"></script>
    <script>
        var vue = new Vue({
            el: "#app",
            data: {
                mobile: "", wechat: "", alipay: "", code: ""
            },
            methods: {
                btnValid: function () {
                    if (this.mobile == "") {
                        layer.msg('手机号码不能为空', { icon: 1 });
                        return;
                    }
                    var reg = /^1\d{10}$/;
                    if (!reg.test(this.mobile)) {
                        layer.msg('手机号码格式不正确', { icon: 1 });
                        return;
                    }
                    if (this.wechat == "") {
                        layer.msg('微信账号不能为空', { icon: 1 });
                        return;
                    }
                    if (this.alipay == "") {
                        layer.msg('支付宝账号不能为空', { icon: 1 });
                        return;
                    }
                    if (this.code == "") {
                        layer.msg('短信验证码不能为空', { icon: 1 });
                        return;
                    }
                    this.$http.post('/user/bindinfo', { id: 1, mobile: this.mobile, wechat: this.wechat, alipay: this.alipay, code: this.code }, { emulateJSON: true }).then(function (result) {
                        if (result.data.status == 1) {
                            layer.alert(result.data.msg, { icon: 1, title: '提示框' }, function () {
                                window.location.href = "/task/index";
                            });                            
                        }
                        else if (result.data.status == 0) {
                            layer.msg(result.data.msg, { icon: 1 });
                        }
                    })
                },
                send: function () {
                    if (this.mobile == "") {
                        layer.msg('手机号码不能为空', { icon: 1 });
                        return;
                    }
                    var reg = /^1\d{10}$/;
                    if (!reg.test(this.mobile)) {
                        layer.msg('手机号码格式不正确', { icon: 1 });
                        return;
                    }
                    this.$http.post('/user/send', { mobile: this.mobile }, { emulateJSON: true }).then(function (result) {
                        if (result.data.status == 1) {
                            layer.msg(result.data.msg, { icon: 1 });
                        }
                        else if (result.data.status == 0) {
                            layer.msg(result.data.msg, { icon: 1 });
                        }
                    })
                }
            }
        });
    </script>
</body>
</html>